<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <title>tst</title>

  <link rel="stylesheet" href="../_data/theme/lib/normalize/normalize.css"/>
  <link rel="stylesheet" href="../_data/theme/css/prism.css"/>
  <link rel="stylesheet" href="../_data/theme/css/admonition.css"/>
  <link rel="stylesheet" href="../_data/theme/css/style.css"/>
  <link rel="stylesheet" href="../_data/theme/css/style-mdoc-ext.css"/>
  <script src="../_data/theme/lib/prism/prism.js"></script>
  <script src="../_data/theme/js/prism-ext.js"></script>
  <script>
      window.mdoc = window.mdoc || {};
      mdoc.indexRef = '../index.html';
  </script>
</head>
<body>
<div class="page-wrap">
  <div class="page-header">
    <div class="page-header-item document-title">
      <a href="../index.html">Jandcode Core</a>
    </div>
    <div class="page-header-item split">
    </div>
    <div class="page-header-item menu-item">
    </div>
  </div>

  <div class="page-body">

    <div class="page-tools">
      <div class="tools-block">
        <div class="tools-block-title">
          Содержание
        </div>
        <div class="tools-block-body">
          <div class="doc-toc">
            <ul><li class="folder "><a href="../intro/intro.html">Введение</a></li>
<li class="folder "><a href="../x/x1.html">Модули</a></li>
<li class="open "><a href="index.html">Jandcode Core Apex</a><ul><li class="cur "><a href="tst.html">tst</a></li>
</ul></li>
</ul>
          </div>
        </div>
      </div>
    </div>

    <div class="page-content">
<div class="topic-breadcrumb">
  <ul class="breadcrumb">
<li><a href="../index.html">Jandcode Core</a></li>
<li><a href="index.html">Jandcode Core Apex</a></li>
<li class="active">tst</li>
</ul>

</div>
<div class="topic-header">
  <h1>tst</h1>
</div>
<div class="topic-toc">
  <div class="topic-toc-title">Содержание</div>
  <div class="topic-toc-content">
    <ul><li class=""><a href="tst.html#head1">Введение</a></li>
<li class=""><a href="tst.html#head2">Папка _tst</a></li>
<li class="folder "><a href="tst.html#head3">Выполнение файлов через /_tst/run</a><ul><li class=""><a href="tst.html#head4">**/*.test.js</a></li>
<li class=""><a href="tst.html#head5">**/*.test.vue</a></li>
<li class=""><a href="tst.html#head6">**/*.html.gsp</a></li>
</ul></li>
<li class="folder "><a href="tst.html#head7">Особые файлы в _tst</a><ul><li class=""><a href="tst.html#head8">vendor.js</a></li>
<li class=""><a href="tst.html#head9">run-js.gsp</a></li>
<li class=""><a href="tst.html#head10">env-tst.js</a></li>
</ul></li>
<li class=""><a href="tst.html#head11">run-js.gsp в подкаталоге</a></li>
</ul>
  </div>
</div>
<div class="topic-body">
  <fieldset class="cm-code-info">
  <legend>Связи</legend>
  <ul>


    <li>
      <span class="cm-code-info--code">jandcode.core.apex.tst</span> <span
        class="cm-code-info--marker">(module)</span>
    </li>





  </ul>
</fieldset>
<p>Поддержка тестирования в контексте клиентского web-приложения.</p>
<h2 id="head1">Введение</h2>
<p>При генерации проекта <code>apex-app</code> к нему по умолчанию подключается
модуль <code>jandcode.core.apex.tst</code>. Он будет загружатся только в
dev-режиме.</p>
<p>При подключенном модуле становится доступен url
<code>http://localhost:8080/jc/_tst</code>.</p>
<p>Модуль содержит ряд инструментов для упрощения тестирования
и прототипирования в web-приложении.</p>
<h2 id="head2">Папка _tst</h2>
<p>Если в корне исходников модуля имеется папка <code>_tst</code>, то ее содержимое рассматривается
как набор тестовых клиентских файлов. Папка по умолчанию создается при генерации проекта
и заполняется некоторым набором файлов.</p>
<p>Эта папка и ее содержимое исключается при сборке модуля в jar.
Соотвественно в product она не попадает.</p>
<h2 id="head3">Выполнение файлов через /_tst/run</h2>
<p>Когда вы щелкаете по пункту меню <code>/_tst/run</code>, вы попадает в список файлов,
которые можно выполнить. Этот список формируется из каталогов <code>_tst</code> всех
доступных модулей в исходниках.
В список попадают файлы:</p>
<ul>
<li><code>**/*.test.js</code></li>
<li><code>**/*.test.vue</code></li>
<li><code>**/*.html.gsp</code></li>
</ul>
<h3 id="head4">**/*.test.js</h3>
<p>Этот js-файл должен содержать экспортируемый метод <code>run()</code> или
определения unit-тестов.</p>
<p>Если имеется метод <code>run()</code>, то этот метод просто выполняется.
Пример файла с методом <code>run()</code>:</p>
<div class="codeblock" data-language="js"><div class="codeblock--title">run1.test.js</div><div class="codeblock--content"><pre><code class="language-js">export function run() {
    console.info(&quot;run!&quot;);
}</code></pre></div></div>
<p>В качестве среды выполнения unittest используется <a href="https://mochajs.org/">mocha</a> в режиме
<code>bdd</code>. Для assert используется библиотека <a href="https://www.chaijs.com/">chai</a>.
Достаточно объявить тесты в тексте js и они будут выполнятся при открытии такого файла.
Пример файла с unittest:</p>
<div class="codeblock" data-language="js"><div class="codeblock--title">test1.test.js</div><div class="codeblock--content"><pre><code class="language-js">import {test} from '../vendor'

describe(__filename, function() {

    it(&quot;test1&quot;, function() {
        test.assert.equal(1, 1)
    })

})</code></pre></div></div>
<h3 id="head5">**/*.test.vue</h3>
<p>Файл содержит vue-компонент, который рендерится.
Любой обычный vue-компонент, но можно использовать и расширенный вариант его,
например:</p>
<div class="codeblock" data-language="html"><div class="codeblock--title">Vue1.test.vue</div><div class="codeblock--content"><pre><code class="language-html">&lt;template&gt;
    &lt;tst-apex-panel&gt;
        &lt;jc-btn label=&quot;hello&quot;/&gt;
    &lt;/tst-apex-panel&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    extends: Vue.component('tst-apex-page'),
    components: {},
    created() {
        this.cfgStore.applyDefault({})
    },
    data() {
        return {}
    },
    methods: {
        applyCfg() {
            let cfg = this.cfg
        },
    }
}
&lt;/script&gt;

&lt;style lang=&quot;less&quot;&gt;
&lt;/style&gt;
</code></pre></div></div>
<p>Кроме того, vue-компонент можно рендерить в контексте вашего приложения,
что бы он мог пользоватся данными и функционалом приложения:</p>
<div class="codeblock" data-language="html"><div class="codeblock--title">InAppVue1.test.vue</div><div class="codeblock--content"><pre><code class="language-html">&lt;template&gt;
    &lt;tst-apex-panel&gt;
        &lt;tst-icon-list/&gt;
    &lt;/tst-apex-panel&gt;
&lt;/template&gt;

&lt;script&gt;

import {main} from '../vendor'

// куда монтировать (по умолчанию в .jc-app--main)
// export let mountTo = '.jc-app--main'

main.run()

export default {
    extends: Vue.component('tst-apex-page'),
    components: {},
    created() {
        this.cfgStore.applyDefault({})
    },
    data() {
        return {}
    },
    methods: {
        applyCfg() {
            let cfg = this.cfg
        },
    }
}
&lt;/script&gt;

&lt;style lang=&quot;less&quot;&gt;
&lt;/style&gt;
</code></pre></div></div>
<h3 id="head6">**/*.html.gsp</h3>
<p>Обычная gsp, рендерится без окружения:</p>
<div class="codeblock" data-language="gsp"><div class="codeblock--title">gsp1.html.gsp</div><div class="codeblock--content"><pre><code class="language-gsp">&lt;%@ page import=&quot;jandcode.commons.*; jandcode.core.*; jandcode.core.web.*; jandcode.core.web.gsp.*;&quot; %&gt;
&lt;%
  BaseGsp th = this
%&gt;
hello!
</code></pre></div></div>
<h2 id="head7">Особые файлы в _tst</h2>
<p>Некоторые файлы в корне <code>_tst</code> имеют важное значение для поддержки тестовой среды.</p>
<h3 id="head8">vendor.js</h3>
<div class="codeblock" data-language="js"><div class="codeblock--title">vendor.js</div><div class="codeblock--content"><pre><code class="language-js">export * from '../js/vendor'
import * as test from 'jandcode.core.apex.webapp/test'
import * as main from '../js/main'

export {
    test,
    main,
}</code></pre></div></div>
<p>Этот файл содержит импорт и экспорт среды, в которой будет проводится
тестирования по умоланию. В своем коде вы можете импортировать из этого файла
то, что вам нужно. И менять его, дополняя необходимымы модулями.</p>
<h3 id="head9">run-js.gsp</h3>
<div class="codeblock" data-language="gsp"><div class="codeblock--title">run-js.gsp</div><div class="codeblock--content"><pre><code class="language-gsp">&lt;jc:page template=&quot;page/tst-apex&quot;&gt;
&lt;/jc:page&gt;</code></pre></div></div>
<p>Этот файл содержит gsp, которая рендерит страницу для запуска файлов js и vue.
При необходимости - его можно заменить на свой вариант.</p>
<h3 id="head10">env-tst.js</h3>
<div class="codeblock" data-language="js"><div class="codeblock--title">env-tst.js</div><div class="codeblock--content"><pre><code class="language-js">import './vendor'</code></pre></div></div>
<p>Этот файл испортируется в <code>run-js.gsp</code> перед вашим кодом.
Используется для разделения импорта среды и кода тестов. Или для воссоздания
особой среды.</p>
<h2 id="head11">run-js.gsp в подкаталоге</h2>
<p>Если создать подкаталог в <code>_tst</code> и поместить в него файл <code>run-js.gsp</code>,
то именно этот файл будет использоватся для рендеринга запускаемых файлов.
Кроме этого, если в этот же каталог поместить <code>env-tst.js</code>, то этот
файл будет использоватся для инициализации среды.
Это можно использовать для определения особой среды для особых частей
тестов.</p>

</div>
    </div>

  </div>

  <div class="page-footer">

  </div>

</div>

</body>
</html>
